<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5M07SFV1BF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-5M07SFV1BF');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USAF AI Performance Statement & Decoration Refinery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- CORE THEME VARIABLES --- */
        :root {
            --bg-dark: #09090b;
            --card-bg: rgba(39, 39, 42, 0.9);
            --border-color: rgba(161, 161, 170, 0.2);
            --text-primary: #e4e4e7;
            --text-secondary: #a1a1aa;
            --primary-purple: #a855f7;
            --primary-cyan: #22d3ee;
            --accent-purple-muted: #c084fc;
            --input-bg: rgba(24, 24, 27, 0.7);
            --success-color: #2ecc71;
            --danger-color: #ef4444;
        }
        
        html[data-theme='light'] {
            --bg-dark: #fafafa;
            --card-bg: rgba(255, 255, 255, 0.95);
            --border-color: #d4d4d8;
            --text-primary: #18181b;
            --text-secondary: #71717a;
            --input-bg: #e4e4e7;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            background-image: radial-gradient(ellipse at top, rgba(168, 85, 247, 0.1), transparent 60%);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        main { flex-grow: 1; position: relative; }

        /* --- SELECTION SCREENS --- */
        .selection-container {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 80vh; text-align: center; transition: opacity 0.5s ease-out;
            position: absolute; width: 100%; left: 0; top: 0;
        }
        
        .selection-container.hidden { opacity: 0; pointer-events: none; display: none !important; }

        .selection-title { font-size: 2.5rem; font-weight: 700; margin-bottom: 3rem; animation: fadeIn 0.8s ease-out forwards; }
        .bubble-container { display: flex; flex-wrap: wrap; gap: 1.5rem; justify-content: center; animation: fadeIn 0.8s ease-out 0.3s forwards; opacity: 0; }
        
        .selection-bubble {
            background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 9999px;
            width: 150px; height: 150px; padding: 0.5rem; display: flex; align-items: center; justify-content: center;
            text-align: center; font-size: 1.25rem; font-weight: 600; color: var(--text-primary); cursor: pointer;
            transition: all 0.3s ease; position: relative;
        }
        .selection-bubble:hover { border-color: var(--primary-purple); transform: scale(1.05); }
        .award-bubble { width: auto; height: auto; padding: 1rem 2rem; border-radius: 9999px; }

        /* --- NEW AWARD TABS --- */
        .award-tab {
            padding: 0.5rem 1.25rem; border-radius: 9999px; background: var(--card-bg);
            border: 1px solid var(--border-color); color: var(--text-secondary);
            font-weight: 600; font-size: 0.9rem; cursor: pointer; transition: all 0.2s ease;
        }
        .award-tab:hover { border-color: var(--primary-purple); color: var(--text-primary); }
        .award-tab.active {
            background: linear-gradient(to right, var(--primary-purple), var(--primary-cyan));
            color: white; border-color: transparent; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.2);
        }

        /* --- ANIMATIONS & LAYOUT --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        #main-tool-container, #decoration-tool-container, #criteria-card-container { display: none; opacity: 0; transition: opacity 0.5s ease-in 0.5s; }
        body.selection-made #main-tool-container, body.selection-made #decoration-tool-container { display: block; opacity: 1; }
        /* Criteria container visibility is handled by JS specifically */
        
        
        .animated-title {
            background: var(--card-bg); border: 1px solid var(--border-color); width: 90%; max-width: 48rem;
            height: auto; padding: 1rem; border-radius: 1rem; font-size: 1.5rem; font-weight: 600;
            text-align: center; margin: 0 auto 2rem auto; animation: fadeIn 0.8s ease-out forwards;
        }
        
        /* --- HEADER --- */
        .header { position: sticky; top: 0; z-index: 50; width: 100%; border-bottom: 1px solid var(--border-color); background-color: rgba(9, 9, 11, 0.8); backdrop-filter: blur(8px); padding: 0 1rem; }
        .header-container { max-width: 1200px; margin: 0 auto; display: flex; height: 4rem; align-items: center; justify-content: space-between; }
        .logo-container { display: flex; align-items: center; gap: 0.5rem; }
        .logo { height: 2.5rem; width: auto; }
        .logo-text { font-size: 1.25rem; font-weight: 700; background: linear-gradient(to right, var(--primary-purple), var(--primary-cyan)); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .theme-toggle-btn { background: var(--input-bg); border: 1px solid var(--border-color); color: var(--text-secondary); width: 2.5rem; height: 2.5rem; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease; margin-left: 1rem; }
        .theme-toggle-btn svg { width: 1.25rem; height: 1.25rem; }

        /* --- CARDS & FORMS --- */
        .card { background: var(--card-bg); backdrop-filter: blur(10px); border: 1px solid var(--border-color); border-radius: 1rem; margin-bottom: 2rem; }
        .card-header { padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-color); font-size: 1.125rem; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .card-body { padding: 1.5rem; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-secondary); }
        input[type="text"], textarea { width: 100%; background-color: var(--input-bg); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 0.5rem; padding: 0.75rem 1rem; transition: all 0.2s ease; }
        input[type="text"]:focus, textarea:focus { outline: none; border-color: var(--primary-purple); box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.2); }
        textarea { min-height: 120px; resize: vertical; }
        
        /* Award Criteria List Styles */
        .criteria-list { list-style-type: disc; padding-left: 1.25rem; margin-top: 0.5rem; color: var(--text-secondary); }
        .criteria-list li { margin-bottom: 0.25rem; }

        /* --- CUSTOM DROPDOWNS --- */
        .custom-picker-input, .custom-dropdown-selected { background-color: var(--input-bg); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 0.5rem; padding: 0.75rem 1rem; transition: all 0.2s ease; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .custom-picker-input:hover, .custom-dropdown-selected:hover { border-color: var(--primary-purple); }
        .custom-picker-input::after, .custom-dropdown-selected::after { content: '‚ñº'; font-size: 0.6rem; color: var(--text-secondary); }
        .floating-dropdown-options { position: absolute; background-color: #18181b; border: 1px solid var(--border-color); border-radius: 0.5rem; max-height: 500px; overflow-y: auto; z-index: 100; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        html[data-theme='light'] .floating-dropdown-options { background-color: #ffffff; }
        .floating-dropdown-header { padding: 0.5rem 0.75rem; font-weight: 700; color: var(--primary-purple); margin-top: 0.5rem; cursor: pointer; border-radius: 0.25rem; }
        .floating-dropdown-subheader { padding: 0.4rem 0.75rem 0.4rem 1rem; font-weight: 600; color: var(--text-secondary); cursor: pointer; border-radius: 0.25rem; }
        .floating-dropdown-header:hover, .floating-dropdown-subheader:hover { background-color: rgba(168, 85, 247, 0.1); }
        .floating-dropdown-option { padding: 0.5rem 0.75rem 0.5rem 1.75rem; cursor: pointer; transition: background-color 0.2s; }
        .floating-dropdown-option:hover { background-color: rgba(168, 85, 247, 0.1); }
        .floating-dropdown-option.selected { background-color: rgba(168, 85, 247, 0.2); font-weight: 600; }

        /* --- BUTTONS --- */
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .btn-primary { background: linear-gradient(to right, var(--primary-purple), var(--primary-cyan)); color: white; }
        .btn-primary:hover { opacity: 0.9; }
        .btn-danger { background: transparent; border: 1px solid var(--danger-color); color: var(--danger-color); }
        .btn-danger:hover { background: rgba(239, 68, 68, 0.1); }
        .btn-ghost { background: transparent; border: 1px solid var(--border-color); color: var(--text-secondary); }
        .btn-ghost:hover { background: var(--input-bg); border-color: var(--text-secondary); }

        /* --- MISC & FOOTER --- */
        .hidden { display: none; }
        footer { text-align: center; padding: 2rem; color: var(--text-secondary); font-size: 0.9rem; margin-top: 2rem; border-top: 1px solid var(--border-color); width: 100%; }

        /* --- DEBUG PANEL --- */
        #debug-panel {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            width: min(1000px, 80vw);
            max-height: calc(100vh - 80px);
            background: var(--card-bg);
            border: 2px solid var(--primary-cyan);
            border-radius: 0.75rem;
            box-shadow: 0 14px 60px rgba(34, 211, 238, 0.16);
            display: flex;
            flex-direction: column;
            z-index: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(6px);
            min-height: 240px;
        }
        #debug-panel.hidden { display: none; }
        #debug-panel-header { padding: 0.9rem 1rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; background: rgba(34, 211, 238, 0.06); border-radius: 0.5rem 0.5rem 0 0; }
        #debug-panel-header h3 { margin: 0; font-size: 1.05rem; font-weight: 700; color: var(--primary-cyan); }
        #debug-panel-close { background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 1.2rem; padding: 0; width: 28px; height: 28px; }
        #debug-output { padding: 1rem 1.5rem; overflow-y: auto; flex: 1; font-family: 'Monaco', 'Courier New', monospace; font-size: 1rem; line-height: 1.5; color: var(--primary-cyan); white-space: pre-wrap; word-break: break-word; text-shadow: 0 0 8px rgba(34, 211, 238, 0.16); background: transparent; border: none; outline: none; resize: none; }
        #debug-toggle { position: fixed; bottom: 1rem; right: 1.5rem; width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(to right, var(--primary-purple), var(--primary-cyan)); border: none; color: white; font-size: 1.6rem; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 22px rgba(168, 85, 247, 0.32); transition: all 0.3s ease; z-index: 501; }
        #debug-toggle:hover { transform: scale(1.04); box-shadow: 0 10px 28px rgba(168, 85, 247, 0.46); }
        #debug-toggle.active { background: linear-gradient(to right, var(--primary-cyan), var(--primary-purple)); }

        /* --- Floating Character Count Panel --- */
        #char-toggle { position: fixed; bottom: 1rem; right: 6.2rem; width: 48px; height: 48px; border-radius: 10px; background: linear-gradient(135deg, rgba(10, 132, 255, 0.12), rgba(34,211,238,0.08)); border: 1px solid var(--border-color); color: var(--text-secondary); display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 502; }
        #char-toggle.active { background: linear-gradient(to right, var(--primary-purple), var(--primary-cyan)); color: #fff; }
        #char-panel { position: fixed; bottom: 4.25rem; right: 1.25rem; width: min(520px, 45vw); max-height: calc(100vh - 160px); background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 0.75rem; box-shadow: 0 8px 30px rgba(0,0,0,0.35); display: none; flex-direction: column; z-index: 503; overflow: hidden; }
        #char-panel.visible { display: flex; }
        #char-panel-header { padding: 0.6rem 0.9rem; border-bottom: 1px solid var(--border-color); display:flex; align-items:center; justify-content:space-between; }
        #char-panel-body { padding: 0.75rem; overflow:auto; }
        #char-panel textarea { width:100%; min-height:120px; resize:vertical; background:var(--input-bg); border-radius:0.5rem; padding:0.75rem; border:1px solid var(--border-color); color:var(--text-primary); }

        /* --- MODALS --- */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); z-index: 1000; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content { background: #18181b; border: 1px solid var(--border-color); border-radius: 1rem; padding: 2rem; width: 90%; max-width: 450px; transform: scale(0.95); transition: transform 0.3s; }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        .modal-title { font-size: 1.5rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.75rem; }
        .modal-body { color: var(--text-secondary); margin-bottom: 1.5rem; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 0.75rem; }
        
        .picker-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 100; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; padding: 1rem; }
        .picker-overlay.visible { opacity: 1; visibility: visible; }
        .picker-modal { background-color: #18181b; border-radius: 1rem; width: 100%; max-width: 28rem; box-shadow: 0 10px 25px rgba(0,0,0,0.3); transform: scale(0.95); transition: transform 0.3s; display: flex; flex-direction: column; max-height: 90vh; }
        .picker-overlay.visible .picker-modal { transform: scale(1); }
        .picker-header { padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-color); display: flex; gap: 1rem; align-items: center; }
        .picker-options-list { list-style: none; padding: 0.5rem; margin: 0; overflow-y: auto; }
        .picker-option-header { padding: 0.75rem 1rem; font-weight: 700; color: var(--primary-purple); margin-top: 0.5rem; cursor: pointer; border-radius: 0.5rem; }
        .picker-option-subheader { padding: 0.6rem 1rem 0.6rem 1.25rem; font-weight: 600; color: var(--text-secondary); cursor: pointer; border-radius: 0.5rem; }
        .picker-option-item { padding: 0.75rem 1rem 0.75rem 2rem; cursor: pointer; border-radius: 0.5rem; transition: background-color 0.2s; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <a href="https://royal-spark.github.io/Landing-Page/" style="text-decoration: none;">
				<div class="logo-container">
					<img src="https://raw.githubusercontent.com/Royal-Spark/Landing-Page/main/royal-spark-logo.png" alt="Royal Spark Logo" class="logo">
					<span class="logo-text">Royal Spark</span>
				</div>
			</a>
            <button id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle theme">
                <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM18.894 6.106a.75.75 0 0 1 0 1.06l-1.591 1.59a.75.75 0 1 1-1.06-1.06l1.59-1.59a.75.75 0 0 1 1.06 0ZM21.75 12a.75.75 0 0 1-.75.75h-2.25a.75.75 0 0 1 0-1.5h2.25a.75.75 0 0 1 .75.75ZM17.894 17.894a.75.75 0 0 1-1.06 0l-1.59-1.591a.75.75 0 1 1 1.06-1.06l1.59 1.59a.75.75 0 0 1 0 1.061ZM12 18.75a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0v-2.25a.75.75 0 0 1 .75-.75ZM5.106 17.894a.75.75 0 0 1 0-1.06l1.59-1.591a.75.75 0 1 1 1.06 1.06l-1.59 1.59a.75.75 0 0 1-1.06 0ZM4.5 12a.75.75 0 0 1-.75.75H1.5a.75.75 0 0 1 0-1.5h2.25a.75.75 0 0 1 .75.75ZM6.106 5.106a.75.75 0 0 1 1.06 0l1.59 1.591a.75.75 0 0 1-1.06 1.06l-1.59-1.59a.75.75 0 0 1 0-1.061Z" /></svg>
                <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="display: none;"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.981A10.503 10.503 0 0 1 18 19.5a10.5 10.5 0 0 1-10.5-10.5A10.503 10.503 0 0 1 9.528 1.718Z" clip-rule="evenodd" /></svg>
            </button>
        </div>
    </header>

	<main class="w-full max-w-7xl mx-auto px-4 sm:px-6 pb-6 pt-8">
        
        <div id="initial-selection-screen" class="selection-container">
            <h2 class="selection-title">What would you like to create?</h2>
            <div class="bubble-container">
                <button id="select-report" class="selection-bubble" data-choice="performance-report">EPB / OPB</button>
                <button id="select-award" class="selection-bubble" data-choice="award-package">Award Package</button>
                <button id="select-decoration" class="selection-bubble" data-choice="decoration">Decoration</button>
            </div>
        </div>

        <div id="award-selection-screen" class="selection-container hidden">
             <h2 class="selection-title">Which Award Package?</h2>
             <div id="award-tabs" class="flex flex-wrap justify-center gap-2 mb-8 px-4">
                 </div>
             <div class="bubble-container" id="award-bubble-container" style="min-height: 200px; align-content: center;">
                 </div>
             <div style="margin-top:2.5rem;">
                 <button id="award-back-btn" class="btn btn-ghost">Back</button>
             </div>
        </div>
        
        <div id="decoration-selection-screen" class="selection-container hidden">
             <h2 class="selection-title">Which Decoration?</h2>
             <div class="bubble-container">
                     <button class="selection-bubble award-bubble" data-decoration-type="afam">Achievement Medal</button>
                     <button class="selection-bubble award-bubble" data-decoration-type="afcm">Commendation Medal</button>
                     <button class="selection-bubble award-bubble" data-decoration-type="msm">Meritorious Service</button>
             </div>
             <div style="margin-top:1.25rem;">
                  <button id="decoration-back-btn" class="btn btn-ghost">Back</button>
             </div>
        </div>

        <div id="decoration-reason-screen" class="selection-container hidden">
             <h2 class="selection-title">What is the Occasion?</h2>
             <div class="bubble-container">
                <button class="selection-bubble award-bubble" data-decoration-reason="single">Single Achievement</button>
                <button class="selection-bubble award-bubble" data-decoration-reason="pca">PCS / PCA</button>
                <button class="selection-bubble award-bubble" data-decoration-reason="custom">Custom</button>
             </div>
        </div>

        <div id="main-content-area" class="lg:grid lg:grid-cols-3 lg:gap-8">
            <div id="animated-title-container" class="lg:col-span-3"></div>

            <div id="main-tool-container" class="lg:col-span-3">
                <div class="card">
                    <div class="card-header">
                        <span>Input Information</span>
                        <button id="resetBtn" class="btn btn-danger">Start Over</button>
                    </div>
                    <div class="card-body">
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div class="form-group">
                                        <label for="jobTitleContainer">Job Title/AFSC: (Optional)</label>
                                        <div id="jobTitleContainer"></div>
                                    </div>
                                    <div class="form-group">
                                        <label for="rankContainer">Rank: (Optional)</label>
                                        <div id="rankContainer"></div>
                                    </div>
                                    <div id="otherJobField" class="form-group hidden md:col-span-2">
                                        <label for="otherJobTitle">Specify Job Title:</label>
                                        <input type="text" id="otherJobTitle" placeholder="e.g., Program Manager">
                                    </div>
                                    <div class="form-group">
                                        <label for="majcomContainer">MAJCOM: (Optional)</label>
                                        <div id="majcomContainer"></div>
                                    </div>
                                    <div id="mga-form-group" class="form-group">
                                        <label for="mgaContainer">Major Graded Area (MGA): (Optional)</label>
                                        <div id="mgaContainer"></div>
                                    </div>
                                    <div id="custom-award-instructions-form-group" class="form-group hidden">
                                        <label for="customAwardInstructions">Custom Award Instructions: (Optional)</label>
                                        <input type="text" id="customAwardInstructions" placeholder="e.g., 'Focus on innovation' or 'Package for wing level'">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="accomplishment">Accomplishment Details: (Required)</label>
                                    <textarea id="accomplishment" placeholder="Describe what you did with metrics in any format..."></textarea>
                                </div>
                                <div class="flex flex-col items-center gap-4 mt-4">
                                    <button id="generateButtonMain" class="btn btn-primary w-full text-lg">Generate & Copy Prompt</button>
                                    <a href="https://genai.mil/" target="_blank" rel="noopener noreferrer" id="GenAI-link-btn-main" class="btn btn-ghost w-full hidden">Go to GenAI.mil</a>
                                </div>
                            </div>
                        </div>
                    </div>

            <div id="criteria-card-container" class="hidden lg:col-span-1">
                <div class="card sticky top-24">
                    <div class="card-header">
                        <span>Criteria & Information</span>
                    </div>
                    <div id="criteria-card-content" class="card-body text-sm space-y-3">
                        </div>
                </div>
            </div>

            <div id="decoration-tool-container" class="lg:col-span-3 hidden">
                <div class="card">
                    <div class="card-header">
                        <span>Decoration Details</span>
                        <button id="resetBtn2" class="btn btn-danger">Start Over</button>
                    </div>
                    <div class="card-body">
                        <div id="dec-single-achievement-section" class="hidden">
                            <div class="form-group">
                                <label for="dec-single-achievement">Specific Achievement:</label>
                                <textarea id="dec-single-achievement" placeholder="Describe the specific achievement..."></textarea>
                            </div>
                        </div>

                        <div id="dec-pca-section" class="hidden">
                            <div class="form-group">
                                <label>Key Achievements (Up to 3):</label>
                                <textarea id="dec-achievement-1" class="mb-2" placeholder="Achievement 1..."></textarea>
                                <textarea id="dec-achievement-2" class="mb-2" placeholder="Achievement 2..."></textarea>
                                <textarea id="dec-achievement-3" placeholder="Achievement 3..."></textarea>
                            </div>
                        </div>

                        <div id="dec-custom-section" class="hidden">
                             <div class="form-group">
                                <label for="dec-custom-input">Reason / Details:</label>
                                <textarea id="dec-custom-input" placeholder="Describe the reason for this decoration..."></textarea>
                            </div>
                        </div>

                        <div class="flex flex-col items-center gap-4 mt-4">
                            <button id="generateButtonDec" class="btn btn-primary w-full text-lg">Generate & Copy Prompt</button>
                            <a href="https://genai.mil/" target="_blank" rel="noopener noreferrer" id="genai-link-btn-dec" class="btn btn-ghost w-full hidden">Go to GenAI.mil</a>
                        </div>
                    </div>
                </div>
            </div>

        </div> </main>
    
    <div id="picker-overlay" class="picker-overlay">
        <div class="picker-modal">
            <div class="picker-header"><button id="picker-back-btn" class="hidden">‚Üê</button><input type="text" id="picker-search-input" placeholder="Type to search..."></div>
            <ul id="picker-options-list" class="picker-options-list"></ul>
        </div>
    </div>
    
    <div id="alert-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="alert-title" class="modal-title">Input Required</h3>
            <p id="alert-body" class="modal-body">Please fill in the required fields.</p>
            <div class="modal-actions"><button id="alert-ok" class="btn btn-primary">OK</button></div>
        </div>
    </div>

    <div id="copy-confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="modal-title">Prompt Copied!</h3>
            <p class="modal-body">Your prompt has been copied to the clipboard.</p>
            <div class="modal-actions">
                <button id="close-copy-modal" class="btn btn-ghost">Close</button>
                <a href="https://genai.mil/" target="_blank" class="btn btn-primary">Go to GenAI.mil</a>
            </div>
        </div>
    </div>

    <button id="char-toggle" title="Toggle Character Tool">üî§</button>
    <button id="debug-toggle" title="Toggle Debug Panel">üêõ</button>


    <div id="char-panel" aria-hidden="true">
        <div id="char-panel-header"><strong style="color: var(--text-primary);">Character Count</strong><div><button id="char-panel-close" class="btn btn-ghost" style="padding:0.25rem 0.5rem;">Close</button></div></div>
        <div id="char-panel-body"><div id="char-panel-inner">
            <div class="card">
                <div class="card-header"><span>Character Count Tool</span></div>
                <div class="card-body">
                    <div class="flex flex-col md:flex-row items-center gap-6">
                        <textarea id="charCounterTextBox" class="w-full h-32 p-4 rounded-lg text-lg transition duration-300 resize-y" placeholder="Paste text or type here..."></textarea>
                        <div class="flex flex-col items-center justify-center p-4">
                            <span id="charCounterCount" class="text-7xl font-bold transition-colors duration-300" style="color: var(--primary-cyan);">0</span>
                            <span class="text-sm uppercase tracking-wider" style="color: var(--text-secondary);">Characters</span>
                        </div>
                    </div>
                </div>
            </div>
        </div></div>
    </div>

    <div id="debug-panel" class="hidden">
        <div id="debug-panel-header"><h3>Debug: Live Prompt Preview</h3><button id="debug-panel-close">‚úï</button></div>
        <textarea id="debug-output" readonly></textarea>
    </div>

    <footer>USAF AI Prompt Generator | For official use only</footer>

    <script>
      let userChoice = { main: '', awardType: '', decorationType: '', decorationReason: '' };
      let promptData = {}, afscOptions = [], rankOptions = [], majcomOptions = [], mgaOptions = [], awardsList = [], awardCriteriaData = {};
      const isTouchDevice = window.matchMedia("(pointer: coarse)").matches;

      // --- LOGIC: Data Loading ---
      async function loadAllData() {
          try {
              const res = await Promise.all([
                  fetch('./prompts.json').then(r => r.json()),
                  fetch('./data/afscOptions.json').then(r => r.json()),
                  fetch('./data/rankOptions.json').then(r => r.json()),
                  fetch('./data/majcomOptions.json').then(r => r.json()),
                  fetch('./data/mgaOptions.json').then(r => r.json()),
                  fetch('./data/awards.json').then(r => r.json()).catch(() => []),
                  fetch('./data/awardcriteria.json').then(r => r.json()).catch(() => ({})) // Fetch new criteria data
              ]);
              [promptData, afscOptions, rankOptions, majcomOptions, mgaOptions, awardsList, awardCriteriaData] = res;
              renderAwards(awardsList);
              return true;
          } catch(e) { 
              console.error("Failed to load JSON data", e);
              return false; 
          }
      }

      // --- LOGIC: Award Tabs (Dynamic) ---
      function groupAwards(awards) {
          const groups = {};
          awards.forEach(a => {
              const cat = a.category || 'General';
              if (!groups[cat]) groups[cat] = [];
              groups[cat].push(a);
          });
          return groups;
      }

      function filterAwards(category, groupedData) {
          document.querySelectorAll('.award-tab').forEach(tab => {
              tab.classList.toggle('active', tab.dataset.category === category);
          });
          const container = document.getElementById('award-bubble-container');
          container.style.opacity = '0';
          setTimeout(() => {
              container.innerHTML = '';
              const list = groupedData[category] || [];
              list.forEach(a => {
                  const btn = document.createElement('button');
                  btn.className = 'selection-bubble award-bubble';
                  btn.textContent = a.title || 'Award';
                  btn.dataset.awardType = a.key || a.title; 
                  btn.onclick = () => {
                      userChoice.awardType = btn.dataset.awardType;
                      showTool();
                  };
                  container.appendChild(btn);
              });
              container.style.opacity = '1';
          }, 150);
      }

      function renderAwards(awards) {
          const tabCont = document.getElementById('award-tabs');
          if (!tabCont || !awards.length) return;
          const grouped = groupAwards(awards);
          const cats = Object.keys(grouped).sort();
          
          tabCont.innerHTML = '';
          cats.forEach((cat, idx) => {
              const btn = document.createElement('button');
              btn.className = 'award-tab';
              btn.textContent = cat;
              btn.dataset.category = cat;
              btn.onclick = () => filterAwards(cat, grouped);
              tabCont.appendChild(btn);
              if (idx === 0) filterAwards(cat, grouped);
          });
      }

      // --- LOGIC: Render Criteria Card ---
      function renderCriteria(key) {
          const contentDiv = document.getElementById('criteria-card-content');
          const data = awardCriteriaData[key];
          
          if (!data) {
              contentDiv.innerHTML = `<p class="text-gray-400 italic">No specific criteria information available for this award.</p>`;
              return;
          }

          let html = '';
          if (data.title) html += `<h4 class="text-primary-purple font-bold mb-2 text-lg">${data.title}</h4>`;
          if (data.content) html += `<p class="text-gray-300 leading-relaxed mb-3">${data.content}</p>`;
          if (data.bullets && data.bullets.length > 0) {
              html += `<ul class="criteria-list">`;
              data.bullets.forEach(b => html += `<li>${b}</li>`);
              html += `</ul>`;
          }
          contentDiv.innerHTML = html;
      }

      // --- LOGIC: UI Switching ---
      function switchScreen(hideId, showId) {
          document.getElementById(hideId).classList.add('hidden');
          document.getElementById(showId).classList.remove('hidden');
      }

      function showTool() {
          let title = '';
          const mainTool = document.getElementById('main-tool-container');
          const decTool = document.getElementById('decoration-tool-container');
          const criteriaContainer = document.getElementById('criteria-card-container');
          
          // Reset displays
          mainTool.style.display = 'none';
          decTool.style.display = 'none';
          criteriaContainer.style.display = 'none'; // Use display none for clean opacity transition reset if needed, but handled by class logic mostly
          criteriaContainer.classList.add('hidden');
          
          document.body.classList.add('selection-made');

          if (userChoice.main === 'performance-report') {
              title = 'Performance Report Refinery';
              mainTool.style.display = 'block';
              
              // Full width for report
              mainTool.classList.remove('lg:col-span-2');
              mainTool.classList.add('lg:col-span-3');

              document.getElementById('mga-form-group').classList.remove('hidden');
              document.getElementById('custom-award-instructions-form-group').classList.add('hidden');
              
          } else if (userChoice.main === 'award-package') {
              title = `Award Package: ${userChoice.awardType}`;
              mainTool.style.display = 'block';
              
              // 2/3 Width for Award to make room for Criteria
              mainTool.classList.remove('lg:col-span-3');
              mainTool.classList.add('lg:col-span-2');
              
              document.getElementById('mga-form-group').classList.add('hidden');
              
              const isCustom = userChoice.awardType === 'custom' || !awardsList.find(a => a.key === userChoice.awardType);
              document.getElementById('custom-award-instructions-form-group').classList.toggle('hidden', !isCustom);
              
              // Show Criteria Card
              criteriaContainer.classList.remove('hidden');
              criteriaContainer.style.display = 'block';
              setTimeout(() => criteriaContainer.style.opacity = '1', 50); // fade in
              
              renderCriteria(userChoice.awardType);
              
          } else if (userChoice.main === 'decoration') {
              title = `Decoration: ${userChoice.decorationType.toUpperCase()} (${userChoice.decorationReason})`;
              decTool.style.display = 'block';
              
              document.getElementById('dec-single-achievement-section').classList.toggle('hidden', userChoice.decorationReason !== 'single');
              document.getElementById('dec-pca-section').classList.toggle('hidden', userChoice.decorationReason !== 'pca');
              document.getElementById('dec-custom-section').classList.toggle('hidden', userChoice.decorationReason !== 'custom');
          }

          document.getElementById('animated-title-container').innerHTML = `<div class="animated-title">${title}</div>`;
      }

// --- LOGIC: Reset ---
      function handleReset() {
          // Clear Inputs
          document.querySelectorAll('textarea, input[type="text"]').forEach(el => el.value = '');
          // Reset Selectors
          ['jobTitle', 'rank', 'majcom', 'mga'].forEach(id => {
              const el = document.getElementById(id);
              if(el) { el.textContent = '-- Select --'; el.dataset.value = ''; }
          });
          // Reset State
          userChoice = { main: '', awardType: '', decorationType: '', decorationReason: '' };
          document.body.classList.remove('selection-made');
          document.getElementById('animated-title-container').innerHTML = '';
          
          // Hide Tools
          document.getElementById('main-tool-container').style.display = 'none';
          document.getElementById('decoration-tool-container').style.display = 'none';
          
          // Explicitly hide Criteria Card
          const criteriaContainer = document.getElementById('criteria-card-container');
          criteriaContainer.classList.add('hidden');
          criteriaContainer.style.display = 'none';
          
          // Reset Screens
          switchScreen('award-selection-screen', 'initial-selection-screen');
          switchScreen('decoration-selection-screen', 'initial-selection-screen');
          switchScreen('decoration-reason-screen', 'initial-selection-screen');
      }

      // --- LOGIC: Prompt Assembly ---
      function assemblePrompt() {
          const getVal = (id) => document.getElementById(id)?.dataset.value || '';
          const inputs = {
              rank: getVal('rank'),
              afsc: getVal('jobTitle'),
              majcom: getVal('majcom'),
              mga: getVal('mga'),
              text: document.getElementById('accomplishment')?.value || ''
          };

          let p = [];
          p.push(promptData.base || "ROLE: USAF Performance Coach.");
          p.push(`CONTEXT: ${inputs.rank} ${inputs.afsc} ${inputs.majcom}`);
          
          if (userChoice.main === 'performance-report') {
              p.push(promptData.typeAddons?.performanceReport || "");
              if (inputs.mga) p.push(`MGA: ${inputs.mga}`);
              p.push(`INPUT: ${inputs.text}`);
          } else if (userChoice.main === 'award-package') {
              p.push(promptData.typeAddons?.awardPackage || "");
              if (promptData.awardAddons?.[userChoice.awardType]) {
                  p.push(promptData.awardAddons[userChoice.awardType]);
              }
              const customInstr = document.getElementById('customAwardInstructions')?.value;
              if (customInstr) p.push(`CUSTOM INSTRUCTIONS: ${customInstr}`);
              p.push(`INPUT: ${inputs.text}`);
          } else if (userChoice.main === 'decoration') {
              if (promptData.decorationAddons?.[userChoice.decorationType]) {
                  p.push(promptData.decorationAddons[userChoice.decorationType]);
              }
              if (userChoice.decorationReason === 'pca') {
                  const ach = [
                      document.getElementById('dec-achievement-1').value,
                      document.getElementById('dec-achievement-2').value,
                      document.getElementById('dec-achievement-3').value
                  ].filter(x => x).join('\n');
                  p.push(`ACHIEVEMENTS:\n${ach}`);
              } else if (userChoice.decorationReason === 'single') {
                   p.push(`ACHIEVEMENT: ${document.getElementById('dec-single-achievement').value}`);
              } else if (userChoice.decorationReason === 'custom') {
                   p.push(`DETAILS: ${document.getElementById('dec-custom-input').value}`);
              }
          }
          
          p.push(promptData.finalInstructions || "");
          return p.join('\n\n');
      }

      function handleGenerate() {
          const prompt = assemblePrompt();
          navigator.clipboard.writeText(prompt);
          document.getElementById('copy-confirmation-modal').classList.add('visible');
          
          // Show GenAI link based on context
          if (userChoice.main === 'decoration') {
              document.getElementById('genai-link-btn-dec').classList.remove('hidden');
          } else {
              document.getElementById('GenAI-link-btn-main').classList.remove('hidden');
          }
      }

      // --- LOGIC: Character Counter (Separate Tool) ---
      const charBox = document.getElementById('charCounterTextBox');
      const charDisplay = document.getElementById('charCounterCount');
      if (charBox) {
          charBox.addEventListener('input', (e) => {
              const len = e.target.value.length;
              charDisplay.textContent = len;
              charDisplay.style.color = len > 350 ? 'var(--danger-color)' : 'var(--primary-cyan)';
          });
      }

      // --- LOGIC: Initialization ---
      document.addEventListener('DOMContentLoaded', async () => {
          await loadAllData();
          createResponsiveSelect('jobTitleContainer', afscOptions, 'jobTitle');
          createResponsiveSelect('rankContainer', rankOptions, 'rank');
          createResponsiveSelect('majcomContainer', majcomOptions, 'majcom');
          createResponsiveSelect('mgaContainer', mgaOptions, 'mga');

          // Main Selection Clicks
          document.getElementById('select-report').onclick = () => { userChoice.main = 'performance-report'; showTool(); };
          document.getElementById('select-award').onclick = () => { userChoice.main = 'award-package'; switchScreen('initial-selection-screen', 'award-selection-screen'); };
          document.getElementById('select-decoration').onclick = () => { userChoice.main = 'decoration'; switchScreen('initial-selection-screen', 'decoration-selection-screen'); };
          
          // Back Buttons
          document.getElementById('award-back-btn').onclick = () => switchScreen('award-selection-screen', 'initial-selection-screen');
          document.getElementById('decoration-back-btn').onclick = () => switchScreen('decoration-selection-screen', 'initial-selection-screen');

          // Decoration Selection
          document.querySelectorAll('[data-decoration-type]').forEach(btn => {
              btn.onclick = () => { userChoice.decorationType = btn.dataset.decorationType; switchScreen('decoration-selection-screen', 'decoration-reason-screen'); };
          });
          document.querySelectorAll('[data-decoration-reason]').forEach(btn => {
              btn.onclick = () => { userChoice.decorationReason = btn.dataset.decorationReason; showTool(); };
          });

          // Action Buttons
          document.getElementById('resetBtn').onclick = handleReset;
          const reset2 = document.getElementById('resetBtn2');
          if(reset2) reset2.onclick = handleReset;
          
          document.getElementById('generateButtonMain').onclick = handleGenerate;
          const genDec = document.getElementById('generateButtonDec');
          if(genDec) genDec.onclick = handleGenerate;

          // Debug Panel
          const debugToggle = document.getElementById('debug-toggle');
          const debugPanel = document.getElementById('debug-panel');
          debugToggle.onclick = () => {
              debugPanel.classList.toggle('hidden');
              if(!debugPanel.classList.contains('hidden')) {
                  document.getElementById('debug-output').value = assemblePrompt();
              }
          };
          document.getElementById('debug-panel-close').onclick = () => debugPanel.classList.add('hidden');
          // Update debug on input
          document.addEventListener('input', () => {
              if(!debugPanel.classList.contains('hidden')) {
                  document.getElementById('debug-output').value = assemblePrompt();
              }
          });

          // Character Panel Toggle
          const charToggle = document.getElementById('char-toggle');
          const charPanel = document.getElementById('char-panel');
          const charPanelClose = document.getElementById('char-panel-close');
          charToggle.onclick = () => {
              charPanel.classList.toggle('visible');
              charToggle.classList.toggle('active');
              if (charPanel.classList.contains('visible')) {
                  setTimeout(() => document.getElementById('charCounterTextBox')?.focus(), 120);
              }
          };
          charPanelClose.onclick = () => { charPanel.classList.remove('visible'); charToggle.classList.remove('active'); };
          
          // Modals
          document.getElementById('alert-ok').onclick = () => document.getElementById('alert-modal').classList.remove('visible');
          document.getElementById('close-copy-modal').onclick = () => {
              document.getElementById('copy-confirmation-modal').classList.remove('visible');
          };
      });

      // --- Custom Dropdown Helpers ---
      function createResponsiveSelect(containerId, options, fieldId) {
         const container = document.getElementById(containerId);
         if (!container) return;
         container.innerHTML = '';
         const div = document.createElement('div');
         div.className = 'custom-dropdown-selected';
         div.id = fieldId;
         div.textContent = '-- Select --';
         div.dataset.value = '';
         div.onclick = (e) => {
             e.stopPropagation();
             const old = document.querySelector('.floating-dropdown-options');
             if(old) old.remove();
             const list = document.createElement('div');
             list.className = 'floating-dropdown-options';
             const rect = div.getBoundingClientRect();
             list.style.cssText = `top:${rect.bottom+window.scrollY}px; left:${rect.left}px; width:${rect.width}px`;
             options.forEach(opt => {
                 const item = document.createElement('div');
                 item.className = 'floating-dropdown-option';
                 item.textContent = opt.text;
                 item.onclick = () => {
                     div.textContent = opt.text;
                     div.dataset.value = opt.value;
                     list.remove();
                 };
                 list.appendChild(item);
             });
             document.body.appendChild(list);
         };
         container.appendChild(div);
      }
      window.onclick = () => { const d = document.querySelector('.floating-dropdown-options'); if(d) d.remove(); };
    </script>
</body>
</html>
